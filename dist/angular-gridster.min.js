/*
 * angular-gridster
 * http://manifestwebdesign.github.io/angular-gridster
 *
 * @version: 0.10.7
 * @license: MIT
 */
!function(a){"use strict";a.module("gridster",[]).constant("gridsterConfig",{columns:6,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:100,defaultSizeX:2,defaultSizeY:1,saveGridItemCalculatedHeightInMobile:!1,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0,scrollSensitivity:20,scrollSpeed:20}}).controller("GridsterCtrl",["gridsterConfig",function(b){a.extend(this,b),this.resizable=a.extend({},b.resizable||{}),this.draggable=a.extend({},b.draggable||{}),this.grid=[],this.destroy=function(){this.grid&&(this.grid.length=0,this.grid=null)},this.setOptions=function(b){if(b)if(b=a.extend({},b),b.draggable&&(a.extend(this.draggable,b.draggable),delete b.draggable),b.resizable&&(a.extend(this.resizable,b.resizable),delete b.resizable),a.extend(this,b),this.margins&&2===this.margins.length)for(var c=0,d=this.margins.length;d>c;++c)this.margins[c]=parseInt(this.margins[c],10),isNaN(this.margins[c])&&(this.margins[c]=0);else this.margins=[0,0]},this.canItemOccupy=function(a,b,c){return b>-1&&c>-1&&a.sizeX+c<=this.columns&&a.sizeY+b<=this.maxRows},this.autoSetItemPosition=function(a){for(var b=0;b<this.maxRows;++b)for(var c=0;c<this.columns;++c){var d=this.getItems(b,c,a.sizeX,a.sizeY,a);if(0===d.length&&this.canItemOccupy(a,b,c))return void this.putItem(a,b,c)}throw new Error("Unable to place item!")},this.getItems=function(a,b,c,d,e){var f=[];c&&d||(c=d=1),!e||e instanceof Array||(e=[e]);for(var g=0;d>g;++g)for(var h=0;c>h;++h){var i=this.getItem(a+g,b+h,e);!i||e&&-1!==e.indexOf(i)||-1!==f.indexOf(i)||f.push(i)}return f},this.removeItem=function(a){for(var b=0,c=this.grid.length;c>b;++b){var d=this.grid[b];if(d){var e=d.indexOf(a);if(-1!==e){d[e]=null;break}}}this.floatItemsUp(),this.updateHeight()},this.getItem=function(a,b,c){!c||c instanceof Array||(c=[c]);for(var d=1;a>-1;){for(var e=1,f=b;f>-1;){var g=this.grid[a];if(g){var h=g[f];if(h&&(!c||-1===c.indexOf(h))&&h.sizeX>=e&&h.sizeY>=d)return h}++e,--f}--a,++d}return null},this.putItems=function(a){for(var b=0,c=a.length;c>b;++b)this.putItem(a[b])},this.putItem=function(a,b,c,d){if(("undefined"==typeof b||null===b)&&(b=a.row,c=a.col,"undefined"==typeof b||null===b))return void this.autoSetItemPosition(a);if(this.canItemOccupy(a,b,c)||(c=Math.min(this.columns-a.sizeX,Math.max(0,c)),b=Math.min(this.maxRows-a.sizeY,Math.max(0,b))),a&&null!==a.oldRow&&"undefined"!=typeof a.oldRow){if(a.oldRow===b&&a.oldColumn===c)return a.row=b,void(a.col=c);var e=this.grid[a.oldRow];e&&e[a.oldColumn]===a&&delete e[a.oldColumn]}a.oldRow=a.row=b,a.oldColumn=a.col=c,this.moveOverlappingItems(a,d),this.grid[b]||(this.grid[b]=[]),this.grid[b][c]=a},this.swapItems=function(a,b){this.grid[a.row][a.col]=b,this.grid[b.row][b.col]=a;var c=a.row,d=a.col;a.row=b.row,a.col=b.col,b.row=c,b.col=d},this.moveOverlappingItems=function(a,b){b?-1===b.indexOf(a)&&(b=b.slice(0),b.push(a)):b=[a];var c=this.getItems(a.row,a.col,a.sizeX,a.sizeY,b);this.moveItemsDown(c,a.row+a.sizeY,b)},this.moveItemsDown=function(a,b,c){if(a&&0!==a.length){a.sort(function(a,b){return a.row-b.row}),c=c?c.slice(0):[];var d,e,f,g={};for(e=0,f=a.length;f>e;++e){d=a[e];var h=g[d.col];("undefined"==typeof h||d.row<h)&&(g[d.col]=d.row)}for(e=0,f=a.length;f>e;++e){d=a[e];var i=b-g[d.col];this.moveItemDown(d,d.row+i,c),c.push(d)}}},this.moveItemDown=function(a,b,c){if(!(a.row>=b)){for(;a.row<b;)++a.row,this.moveOverlappingItems(a,c);this.putItem(a,a.row,a.col,c)}},this.floatItemsUp=function(){if(this.floating!==!1)for(var a=0,b=this.grid.length;b>a;++a){var c=this.grid[a];if(c)for(var d=0,e=c.length;e>d;++d)c[d]&&this.floatItemUp(c[d])}},this.floatItemUp=function(a){if(this.floating!==!1){for(var b=a.col,c=a.sizeY,d=a.sizeX,e=null,f=null,g=a.row-1;g>-1;){var h=this.getItems(g,b,d,c,a);if(0!==h.length)break;e=g,f=b,--g}null!==e&&this.putItem(a,e,f)}},this.updateHeight=function(a){var b=this.minRows;a||(a=0);for(var c=this.grid.length;c>=0;--c){var d=this.grid[c];if(d)for(var e=0,f=d.length;f>e;++e)d[e]&&(b=Math.max(b,c+a+d[e].sizeY))}this.gridHeight=this.maxRows-b>0?Math.min(this.maxRows,b):Math.max(this.maxRows,b)},this.pixelsToRows=function(a,b){return b===!0?Math.ceil(a/this.curRowHeight):b===!1?Math.floor(a/this.curRowHeight):Math.round(a/this.curRowHeight)},this.pixelsToColumns=function(a,b){return b===!0?Math.ceil(a/this.curColWidth):b===!1?Math.floor(a/this.curColWidth):Math.round(a/this.curColWidth)}}]).directive("gridster",["$timeout","$rootScope","$window",function(b,c,d){return{restrict:"EAC",transclude:!0,replace:!0,template:'<div ng-class="gridsterClass()"><div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div><div class="gridster-content" ng-transclude></div></div>',controller:"GridsterCtrl",controllerAs:"gridster",scope:{config:"=?gridster"},compile:function(){return function(e,f,g,h){function i(){var a=parseInt(f.css("width"))||f.prop("offsetWidth");a&&a!==m&&!h.movingItem&&(m=a,h.loaded&&f.removeClass("gridster-loaded"),k(),h.loaded&&f.addClass("gridster-loaded"),e.$parent.$broadcast("gridster-resized",[a,f.offsetHeight]))}function j(){i(),b(function(){e.$apply()})}h.loaded=!1,e.gridsterClass=function(){return{gridster:!0,"gridster-desktop":!h.isMobile,"gridster-mobile":h.isMobile,"gridster-loaded":h.loaded}},e.previewStyle=function(){return h.movingItem?{display:"block",height:h.movingItem.sizeY*h.curRowHeight-h.margins[0]+"px",width:h.movingItem.sizeX*h.curColWidth-h.margins[1]+"px",top:h.movingItem.row*h.curRowHeight+(h.outerMargin?h.margins[0]:0)+"px",left:h.movingItem.col*h.curColWidth+(h.outerMargin?h.margins[1]:0)+"px"}:{display:"none"}};var k=function(){h.setOptions(e.config),h.curWidth="auto"===h.width?parseInt(f.css("width"))||f.prop("offsetWidth"):h.width,h.curColWidth="auto"===h.colWidth?parseInt((h.curWidth+(h.outerMargin?-h.margins[1]:h.margins[1]))/h.columns):h.colWidth,"string"==typeof h.rowHeight?"match"===h.rowHeight?h.curRowHeight=h.curColWidth:-1!==h.rowHeight.indexOf("*")?h.curRowHeight=h.curColWidth*h.rowHeight.replace("*","").replace(" ",""):-1!==h.rowHeight.indexOf("/")&&(h.curRowHeight=h.curColWidth/h.rowHeight.replace("/","").replace(" ","")):h.curRowHeight=h.rowHeight,h.isMobile=h.mobileModeEnabled&&h.curWidth<=h.mobileBreakPoint;for(var a=0,b=h.grid.length;b>a;++a){var c=h.grid[a];if(c)for(var d=0,g=c.length;g>d;++d)if(c[d]){var i=c[d];i.setElementPosition(),i.setElementSizeY(),i.setElementSizeX()}}l()};e.$watch("config",k,!0),e.$watch("config.draggable",function(){c.$broadcast("gridster-draggable-changed")},!0),e.$watch("config.resizable",function(){c.$broadcast("gridster-resizable-changed")},!0);var l=function(){f.css("height",h.gridHeight*h.curRowHeight+(h.outerMargin?h.margins[0]:-h.margins[0])+"px")};e.$watch("gridster.gridHeight",l);var m=parseInt(f.css("width"))||f.prop("offsetWidth");"function"==typeof f.resize&&f.resize(j);var n=a.element(d);n.on("resize",j),e.$watch(function(){var a=parseInt(f.css("width"))||f.prop("offsetWidth");return a},i),e.$on("$destroy",function(){h.destroy(),n.off("resize",j)}),b(function(){e.$watch("gridster.floating",function(){h.floatItemsUp()}),h.loaded=!0},100)}}}}]).controller("GridsterItemCtrl",function(){this.$element=null,this.gridster=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.init=function(a,b){this.$element=a,this.gridster=b,this.sizeX=b.defaultSizeX,this.sizeY=b.defaultSizeY},this.destroy=function(){this.gridster=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.gridster.movingItem===this},this.setPosition=function(a,b){this.gridster.putItem(this,a,b),this.gridster.loaded&&this.gridster.floatItemsUp(),this.gridster.updateHeight(this.isMoving()?this.sizeY:0),this.isMoving()||this.setElementPosition()},this.setSize=function(a,b){a=a.toUpperCase();var c="size"+a,d="Size"+a;if(""!==b){b=parseInt(b,10),(isNaN(b)||0===b)&&(b=this.gridster["default"+d]);var e=!(this[c]===b&&this["old"+d]&&this["old"+d]===b);this["old"+d]=this[c]=b,this.isMoving()||this["setElement"+d](),e&&(this.gridster.moveOverlappingItems(this),this.gridster.loaded&&this.gridster.floatItemsUp(),this.gridster.updateHeight(this.isMoving()?this.sizeY:0))}},this.setSizeY=function(a){this.setSize("y",a)},this.setSizeX=function(a){this.setSize("x",a)},this.setElementPosition=function(){this.$element.css(this.gridster.isMobile?{marginLeft:this.gridster.margins[0]+"px",marginRight:this.gridster.margins[0]+"px",marginTop:this.gridster.margins[1]+"px",marginBottom:this.gridster.margins[1]+"px",top:"",left:""}:{margin:0,top:this.row*this.gridster.curRowHeight+(this.gridster.outerMargin?this.gridster.margins[0]:0)+"px",left:this.col*this.gridster.curColWidth+(this.gridster.outerMargin?this.gridster.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.gridster.isMobile&&!this.gridster.saveGridItemCalculatedHeightInMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]+"px")},this.setElementSizeX=function(){this.gridster.isMobile?this.$element.css("width",""):this.$element.css("width",this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]+"px")}}).factory("GridsterDraggable",["$document","$timeout","$window",function(b,c,d){function e(e,f,g,h,i){function j(a){x=a.pageX,y=a.pageY,p=parseInt(e.css("left")),q=parseInt(e.css("top")),r=parseInt(e.css("width")),s=parseInt(e.css("height")),t=h.col,u=h.row,m(a),b.on("mousemove",k),b.on("mouseup",l)}function k(a){var b=g.curWidth-1;v=a.pageX,w=a.pageY;var c=v-x+z,d=w-y+A;z=A=0,x=v,y=w;var f=c,h=d;D>p+f?(c=D-p,z=f-c):p+r+f>b&&(c=b-p-r,z=f-c),B>q+h?(d=B-q,A=h-d):q+s+h>C&&(d=C-q-s,A=h-d),p+=c,q+=d,e.css({top:q+"px",left:p+"px"}),n(a),a.stopPropagation(),a.preventDefault()}function l(a){b.off("mouseup",l),b.off("mousemove",k),z=A=0,o(a)}function m(a){e.addClass("gridster-item-moving"),g.movingItem=h,g.updateHeight(h.sizeY),f.$apply(function(){g.draggable&&g.draggable.start&&g.draggable.start(a,e,i)})}function n(a){var b=h.row,c=h.col,j=g.draggable&&g.draggable.drag,k=g.draggable.scrollSensitivity,l=g.draggable.scrollSpeed,m=g.pixelsToRows(q),n=g.pixelsToColumns(p),o=g.getItems(m,n,h.sizeX,h.sizeY,h),r=0!==o.length;if(g.swapping===!0&&r){var s=o[0],t=s.sizeX===h.sizeX&&s.sizeY===h.sizeY,u=s.row===m&&s.col===n;u&&t&&g.swapItems(h,s)}g.pushing===!1&&r||(h.row=m,h.col=n),a.pageY-E.body.scrollTop<k?E.body.scrollTop=E.body.scrollTop-l:d.innerHeight-(a.pageY-E.body.scrollTop)<k&&(E.body.scrollTop=E.body.scrollTop+l),a.pageX-E.body.scrollLeft<k?E.body.scrollLeft=E.body.scrollLeft-l:d.innerWidth-(a.pageX-E.body.scrollLeft)<k&&(E.body.scrollLeft=E.body.scrollLeft+l),(j||b!==h.row||c!==h.col)&&f.$apply(function(){j&&g.draggable.drag(a,e,i)})}function o(a){e.removeClass("gridster-item-moving");var b=g.pixelsToRows(q),c=g.pixelsToColumns(p);(g.pushing!==!1||0===g.getItems(b,c,h.sizeX,h.sizeY,h).length)&&(h.row=b,h.col=c),g.movingItem=null,h.setPosition(h.row,h.col),h.setSizeY(h.sizeY>g.maxRows?g.maxRows:h.sizeY),h.setSizeX(h.sizeX>g.columns?g.columns:h.sizeX);var d=t!==h.col||u!==h.row;f.$apply(function(){d&&g.draggable&&g.draggable.stop&&g.draggable.stop(a,e,i)})}var p,q,r,s,t,u,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=9999,D=0,E=b[0],F=!1,G=null;this.enable=function(){var b=this;c(function(){b.disable(),g.draggable&&g.draggable.handle?(G=a.element(e[0].querySelector(g.draggable.handle)),0===G.length&&(G=e)):G=e,G.on("mousedown",j),F=!0})},this.disable=function(){F&&(b.off("mouseup",l),b.off("mousemove",k),G&&G.off("mousedown",j),F=!1)},this.toggle=function(a){a?this.enable():this.disable()},this.destroy=function(){this.disable()}}return e}]).factory("GridsterResizable",["$document",function(b){function c(c,d,e,f,g){function h(h){function i(a){x=a.pageX,y=a.pageY,o=parseInt(c.css("left")),p=parseInt(c.css("top")),q=parseInt(c.css("width")),r=parseInt(c.css("height")),s=f.sizeX,t=f.sizeY,j(a),b.on("mousemove",k),b.on("mouseup",l),a.preventDefault(),a.stopPropagation()}function j(a){c.addClass("gridster-item-moving"),e.movingItem=f,f.setElementSizeX(),f.setElementSizeY(),f.setElementPosition(),e.updateHeight(1),d.$apply(function(){e.resizable&&e.resizable.start&&e.resizable.start(a,c,g)})}function k(a){var b=e.curWidth-1;v=a.pageX,w=a.pageY;var d=v-x+z,f=w-y+A;z=A=0,x=v,y=w;var g=f,h=d;u.indexOf("n")>=0&&(E>r-g?(f=r-E,A=g-f):B>p+g&&(f=B-p,A=g-f),p+=f,r-=f),u.indexOf("s")>=0&&(E>r+g?(f=E-r,A=g-f):p+r+g>C&&(f=C-p-r,A=g-f),r+=f),u.indexOf("w")>=0&&(F>q-h?(d=q-F,z=h-d):D>o+h&&(d=D-o,z=h-d),o+=d,q-=d),u.indexOf("e")>=0&&(F>q+h?(d=F-q,z=h-d):o+q+h>b&&(d=b-o-q,z=h-d),q+=d),c.css({top:p+"px",left:o+"px",width:q+"px",height:r+"px"}),m(a),a.preventDefault(),a.stopPropagation()}function l(a){b.off("mouseup",l),b.off("mousemove",k),z=A=0,n(a)}function m(a){var b=f.row,h=f.col,i=f.sizeX,j=f.sizeY,k=e.resizable&&e.resizable.resize,l=e.pixelsToRows(p,!1),m=e.pixelsToColumns(o,!1),n=e.pixelsToColumns(q,!0),s=e.pixelsToRows(r,!0);(e.pushing!==!1||0===e.getItems(l,m,n,s,f).length)&&(f.row=l,f.col=m,f.sizeX=n,f.sizeY=s),(k||f.row!==b||f.col!==h||f.sizeX!==i||f.sizeY!==j)&&d.$apply(function(){k&&e.resizable.resize(a,c,g)})}function n(a){c.removeClass("gridster-item-moving"),e.movingItem=null,f.setPosition(f.row,f.col),f.setSizeY(f.sizeY),f.setSizeX(f.sizeX>e.columns?e.columns:f.sizeX);var b=s!==f.sizeX||t!==f.sizeY;d.$apply(function(){b&&e.resizable&&e.resizable.stop&&e.resizable.stop(a,c,g)})}var o,p,q,r,s,t,u=h,v=0,w=0,x=0,y=0,z=0,A=0,B=0,C=9999,D=0,E=e.curRowHeight-e.margins[0],F=e.curColWidth-e.margins[1],G=null;this.enable=function(){G||(G=a.element('<div class="gridster-item-resizable-handler handle-'+u+'"></div>'),c.append(G)),G.on("mousedown",i)},this.disable=function(){G&&(G.off("mousedown",i),G.remove(),G=null),b.off("mouseup",l),b.off("mousemove",k)},this.destroy=function(){this.disable()}}var i=[],j=e.resizable.handles;"string"==typeof j&&(j=e.resizable.handles.split(","));for(var k=!1,l=0,m=j.length;m>l;l++)i.push(new h(j[l]));this.enable=function(){if(!k){for(var a=0,b=i.length;b>a;a++)i[a].enable();k=!0}},this.disable=function(){if(k){for(var a=0,b=i.length;b>a;a++)i[a].disable();k=!1}},this.toggle=function(a){a?this.enable():this.disable()},this.destroy=function(){for(var a=0,b=i.length;b>a;a++)i[a].destroy()}}return c}]).directive("gridsterItem",["$parse","GridsterDraggable","GridsterResizable",function(a,b,c){return{restrict:"EA",controller:"GridsterItemCtrl",require:["^gridster","gridsterItem"],link:function(d,e,f,g){function h(){m.setPosition(m.row,m.col),p.row&&p.row.assign&&p.row.assign(d,m.row),p.col&&p.col.assign&&p.col.assign(d,m.col)}function i(){var a=document.createElement("div"),b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var c in b)if(void 0!==a.style[c])return b[c]}var j,k=f.gridsterItem,l=g[0],m=g[1];if(k){var n=a(k);j=n(d)||{},!j&&n.assign&&(j={row:m.row,col:m.col,sizeX:m.sizeX,sizeY:m.sizeY},n.assign(d,j))}else j=f;m.init(e,l),e.addClass("gridster-item");for(var o=["sizeX","sizeY","row","col"],p={},q=function(b){var c;if("string"==typeof j[b])c=j[b];else if("string"==typeof j[b.toLowerCase()])c=j[b.toLowerCase()];else{if(!k)return;c=a(k+"."+b)}p[b]=a(c),d.$watch(c,function(a){a=parseInt(a,10),isNaN(a)||(m[b]=a)});var e=p[b](d);"number"==typeof e&&(m[b]=e)},r=0,s=o.length;s>r;++r)q(o[r]);d.$watch(function(){return m.row},h),d.$watch(function(){return m.col},h),d.$watch(function(){return m.sizeY},function(a){m.setSizeY(a),p.sizeY&&p.sizeY.assign&&p.sizeY.assign(d,m.sizeY)}),d.$watch(function(){return m.sizeX},function(a){m.setSizeX(a),p.sizeX&&p.sizeX.assign&&p.sizeX.assign(d,m.sizeX)});var t=new b(e,d,l,m,j),u=new c(e,d,l,m,j);return d.$on("gridster-draggable-changed",function(){t.toggle(l.draggable&&l.draggable.enabled)}),d.$on("gridster-resizable-changed",function(){u.toggle(l.resizable&&l.resizable.enabled)}),d.$on("gridster-resized",function(){u.disable(),u.enable()}),l.draggable&&l.draggable.enabled&&t.enable(),l.resizable&&l.resizable.enabled&&u.enable(),e.on(i(),function(){d.$apply(function(){d.$broadcast("gridster-item-transition-end")})}),d.$on("$destroy",function(){try{u.destroy(),t.destroy()}catch(a){}try{l.removeItem(m)}catch(a){}try{m.destroy()}catch(a){}})}}}])}(angular);