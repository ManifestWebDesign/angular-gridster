/*
 * angular-gridster
 * http://manifestwebdesign.github.io/angular-gridster
 *
 * @version: 0.13.4
 * @license: MIT
 */
!function(a,b){"use strict";"function"==typeof define&&define.amd?define(["angular"],b):"object"==typeof exports?module.exports=b(require("angular")):b(a.angular)}(this,function(a){"use strict";return a.module("gridster",[]).constant("gridsterConfig",{columns:6,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:100,fixRows:!1,gridsterLayout:!1,headers:[],defaultSizeX:2,defaultSizeY:1,minSizeX:1,maxSizeX:null,minSizeY:1,maxSizeY:null,saveGridItemCalculatedHeightInMobile:!1,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0,scrollSensitivity:20,scrollSpeed:15}}).controller("GridsterCtrl",["gridsterConfig","$timeout","$rootScope",function(b,c,d){var e=this;a.extend(this,b),this.resizable=a.extend({},b.resizable||{}),this.draggable=a.extend({},b.draggable||{});var f=!1;this.layoutChanged=function(){f||(f=!0,c(function(){f=!1,e.loaded&&e.floatItemsUp(),e.updateHeight(e.movingItem?e.movingItem.sizeY:0)},30))},this.grid=[],this.destroy=function(){this.grid&&(this.grid=[]),this.$element=null},this.setOptions=function(b){if(b)if(b=a.extend({},b),b.draggable&&(a.extend(this.draggable,b.draggable),delete b.draggable),b.resizable&&(a.extend(this.resizable,b.resizable),delete b.resizable),a.extend(this,b),this.margins&&2===this.margins.length)for(var c=0,d=this.margins.length;d>c;++c)this.margins[c]=parseInt(this.margins[c],10),isNaN(this.margins[c])&&(this.margins[c]=0);else this.margins=[0,0]},this.canItemOccupy=function(a,b,c){return b>-1&&c>-1&&a.sizeX+c<=this.columns&&a.sizeY+b<=this.maxRows},this.autoSetItemPosition=function(a){for(var b=0;b<this.maxRows;++b)for(var c=0;c<this.columns;++c){var e=this.getItems(b,c,a.sizeX,a.sizeY,a);if(0===e.length&&this.canItemOccupy(a,b,c))return void this.putItem(a,b,c)}d.$broadcast("gridster-item-unplaceable",a)},this.getItems=function(a,b,c,d,e){var f=[];c&&d||(c=d=1),!e||e instanceof Array||(e=[e]);for(var g=0;d>g;++g)for(var h=0;c>h;++h){var i=this.getItem(a+g,b+h,e);!i||e&&-1!==e.indexOf(i)||-1!==f.indexOf(i)||f.push(i)}return f},this.getBoundingBox=function(a){if(0===a.length)return null;if(1===a.length)return{row:a[0].row,col:a[0].col,sizeY:a[0].sizeY,sizeX:a[0].sizeX};for(var b=0,c=0,d=9999,e=9999,f=0,g=a.length;g>f;++f){var h=a[f];d=Math.min(h.row,d),e=Math.min(h.col,e),b=Math.max(h.row+h.sizeY,b),c=Math.max(h.col+h.sizeX,c)}return{row:d,col:e,sizeY:b-d,sizeX:c-e}},this.removeItem=function(a){for(var b=0,c=this.grid.length;c>b;++b){var d=this.grid[b];if(d){var e=d.indexOf(a);if(-1!==e){d[e]=null;break}}}this.layoutChanged()},this.getItem=function(a,b,c){!c||c instanceof Array||(c=[c]);for(var d=1;a>-1;){for(var e=1,f=b;f>-1;){var g=this.grid[a];if(g){var h=g[f];if(h&&(!c||-1===c.indexOf(h))&&h.sizeX>=e&&h.sizeY>=d)return h}++e,--f}--a,++d}return null},this.putItems=function(a){for(var b=0,c=a.length;c>b;++b)this.putItem(a[b])},this.putItem=function(a,b,c,d){if(("undefined"==typeof b||null===b)&&(b=a.row,c=a.col,"undefined"==typeof b||null===b))return void this.autoSetItemPosition(a);if(this.canItemOccupy(a,b,c)||(c=Math.min(this.columns-a.sizeX,Math.max(0,c)),b=Math.min(this.maxRows-a.sizeY,Math.max(0,b))),null!==a.oldRow&&"undefined"!=typeof a.oldRow){var e=a.oldRow===b&&a.oldColumn===c,f=this.grid[b]&&this.grid[b][c]===a;if(e&&f)return a.row=b,void(a.col=c);var g=this.grid[a.oldRow];g&&g[a.oldColumn]===a&&delete g[a.oldColumn]}a.oldRow=a.row=b,a.oldColumn=a.col=c,this.moveOverlappingItems(a,d),this.grid[b]||(this.grid[b]=[]),this.grid[b][c]=a,this.movingItem===a&&this.floatItemUp(a),this.layoutChanged()},this.swapItems=function(a,b){this.grid[a.row][a.col]=b,this.grid[b.row][b.col]=a;var c=a.row,d=a.col;a.row=b.row,a.col=b.col,b.row=c,b.col=d},this.moveOverlappingItems=function(a,b){b?-1===b.indexOf(a)&&(b=b.slice(0),b.push(a)):b=[a];var c=this.getItems(a.row,a.col,a.sizeX,a.sizeY,b);this.moveItemsDown(c,a.row+a.sizeY,b)},this.moveItemsDown=function(a,b,c){if(a&&0!==a.length){a.sort(function(a,b){return a.row-b.row}),c=c?c.slice(0):[];var d,e,f,g={};for(e=0,f=a.length;f>e;++e){d=a[e];var h=g[d.col];("undefined"==typeof h||d.row<h)&&(g[d.col]=d.row)}for(e=0,f=a.length;f>e;++e){d=a[e];var i=b-g[d.col];this.moveItemDown(d,d.row+i,c),c.push(d)}}},this.moveItemDown=function(a,b,c){if(!(a.row>=b)){for(;a.row<b;)++a.row,this.moveOverlappingItems(a,c);this.putItem(a,a.row,a.col,c)}},this.floatItemsUp=function(){if(this.floating!==!1)for(var a=0,b=this.grid.length;b>a;++a){var c=this.grid[a];if(c)for(var d=0,e=c.length;e>d;++d){var f=c[d];f&&this.floatItemUp(f)}}},this.floatItemUp=function(a){if(this.floating!==!1){for(var b=a.col,c=a.sizeY,d=a.sizeX,e=null,f=null,g=a.row-1;g>-1;){var h=this.getItems(g,b,d,c,a);if(0!==h.length)break;e=g,f=b,--g}null!==e&&this.putItem(a,e,f)}},this.itemsInTheWayCanFit=function(a,b,c,d){for(var e=!0,f=0,g=0,h=a.length;h>g;++g){var i=a[g];if(f+=i.sizeY,b+d.sizeY+i.sizeY>this.maxRows)return!1;var j=this.getItems(b+d.sizeY,c,i.sizeX,i.sizeY,i),k=0!==j.length;k&&(e=this.itemsInTheWayCanFit(j,b+d.sizeY,c,i))}return b+d.sizeY+f>this.maxRows?!1:e},this.updateHeight=function(a){var b=this.minRows;if(this.fixRows)return void(this.gridHeight=this.maxRows);a=a||0;for(var c=this.grid.length;c>=0;--c){var d=this.grid[c];if(d)for(var e=0,f=d.length;f>e;++e)d[e]&&(b=Math.max(b,c+a+d[e].sizeY))}var g=this.maxRows-b>0?Math.min(this.maxRows,b):Math.max(this.maxRows,b);g>this.maxRows&&(g=this.maxRows),this.gridHeight=g},this.pixelsToRows=function(a,b){return b===!0?(a+=this.margins[0]/2,Math.ceil(a/this.curRowHeight)):b===!1?(a+=this.margins[0]/2,Math.floor(a/this.curRowHeight)):Math.round(a/this.curRowHeight)},this.rowsToPixels=function(a,b){return b===!0?Math.ceil(a*this.curRowHeight):b===!1?Math.floor(a+this.curRowHeight):Math.round(a*this.curRowHeight)},this.pixelsToColumns=function(a,b){return b===!0?(a+=this.margins[1]/2,Math.ceil(a/this.curColWidth)):b===!1?(a+=this.margins[1]/2,Math.floor(a/this.curColWidth)):Math.round(a/this.curColWidth)}}]).directive("gridsterLayout",function(){return{restrict:"E",template:'<div class="grid-layout"><div ng-if="gridster.headers.length>0" class="headers" ng-attr-style="top:-{{gridster.headersHeight}}px;"><div ng-repeat="header in gridster.headers" class="row-header" ng-attr-style="height: {{gridster.curRowHeight}}px;width: {{gridster.curColWidth-gridster.margins[1]}}px;">{{header}}</div></div><div ng-repeat="column in range(gridster.columns) track by $index" class="column" ng-attr-style="width: {{gridster.curColWidth-gridster.margins[1]}}px; margin-left: {{gridster.margins[1]}}px; margin-top: {{gridster.margins[0]}}px;"><div ng-repeat="row in range(gridster.maxRows-1) track by $index" class="row" ng-attr-style="height: {{gridster.curRowHeight}}px;"></div></div></div>',scope:!0,require:"^gridster",link:function(a,b,c,d){a.range=function(a){return new Array(+a)},d.curRowHeight=d.rowHeight,"string"==typeof d.rowHeight&&("match"===d.rowHeight?d.curRowHeight=Math.round(d.curColWidth):-1!==d.rowHeight.indexOf("*")?d.curRowHeight=Math.round(d.curColWidth*d.rowHeight.replace("*","").replace(" ","")):-1!==d.rowHeight.indexOf("/")&&(d.curRowHeight=Math.round(d.curColWidth/d.rowHeight.replace("/","").replace(" ","")))),d.headers.length>0&&(d.headersHeight=30,d.curRowHeight>30&&(d.headersHeight=d.curRowHeight),d.$element[0].style.top=d.headersHeight+"px",d.$element[0].style.marginBottom=d.headersHeight+"px"),"auto"===d.colWidth?d.curColWidth=(d.curWidth+(d.outerMargin?-d.margins[1]:d.margins[1]))/d.columns:d.curColWidth=d.colWidth}}}).directive("gridsterPreview",function(){return{replace:!0,scope:!0,require:"^gridster",template:'<div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div>',link:function(a,b,c,d){a.previewStyle=function(){return d.movingItem?{display:"block",height:d.movingItem.sizeY*d.curRowHeight-d.margins[0]+"px",width:d.movingItem.sizeX*d.curColWidth-d.margins[1]+"px",top:d.movingItem.row*d.curRowHeight+(d.outerMargin?d.margins[0]:0)+"px",left:d.movingItem.col*d.curColWidth+(d.outerMargin?d.margins[1]:0)+"px"}:{display:"none"}}}}}).directive("gridster",["$timeout","$window","$rootScope","gridsterDebounce",function(b,c,d,e){return{scope:!0,restrict:"EAC",controller:"GridsterCtrl",controllerAs:"gridster",compile:function(f){return f.prepend('<div gridster-layout ng-if="gridster.gridsterLayout"></div>'),f.prepend('<div ng-if="gridster.movingItem" gridster-preview></div>'),function(f,g,h,i){function j(a){if(i.setOptions(a),m(g[0])){"auto"===i.width?i.curWidth=g[0].offsetWidth||parseInt(g.css("width"),10):"match"===i.width?"auto"===i.colWidth?i.curWidth=g[0].offsetWidth||parseInt(g.css("width"),10):i.curWidth=i.colWidth*i.columns+(i.outerMargin?+i.margins[1]:i.margins[1]):i.curWidth=i.width,"auto"===i.colWidth?i.curColWidth=(i.curWidth+(i.outerMargin?-i.margins[1]:i.margins[1]))/i.columns:i.curColWidth=i.colWidth,i.curRowHeight=i.rowHeight,"string"==typeof i.rowHeight&&("match"===i.rowHeight?i.curRowHeight=Math.round(i.curColWidth):-1!==i.rowHeight.indexOf("*")?i.curRowHeight=Math.round(i.curColWidth*i.rowHeight.replace("*","").replace(" ","")):-1!==i.rowHeight.indexOf("/")&&(i.curRowHeight=Math.round(i.curColWidth/i.rowHeight.replace("/","").replace(" ","")))),i.isMobile=i.mobileModeEnabled&&i.curWidth<=i.mobileBreakPoint;for(var b=0,c=i.grid.length;c>b;++b){var d=i.grid[b];if(d)for(var e=0,f=d.length;f>e;++e)if(d[e]){var h=d[e];h.setElementPosition(),h.setElementSizeY(),h.setElementSizeX()}}k(),l()}}function k(){g.css("height",i.gridHeight*i.curRowHeight+(i.outerMargin?i.margins[0]:-i.margins[0])+"px")}function l(){"match"===i.width&&g.css("width",i.curWidth+"px")}i.loaded=!1,i.$element=g,f.gridster=i,g.addClass("gridster");var m=function(a){return"hidden"!==a.style.visibility&&"none"!==a.style.display},n=h.gridster;n?f.$parent.$watch(n,function(a){j(a)},!0):j({}),f.$watch(function(){return i.loaded},function(){i.loaded?g.addClass("gridster-loaded"):g.removeClass("gridster-loaded")}),f.$watch(function(){return i.isMobile},function(){i.isMobile?g.addClass("gridster-mobile").removeClass("gridster-desktop"):g.removeClass("gridster-mobile").addClass("gridster-desktop"),d.$broadcast("gridster-mobile-changed",i)}),f.$watch(function(){return i.draggable},function(){d.$broadcast("gridster-draggable-changed",i)},!0),f.$watch(function(){return i.resizable},function(){d.$broadcast("gridster-resizable-changed",i)},!0),f.$watch(function(){return i.gridHeight},k),f.$watch(function(){return i.movingItem},function(){i.updateHeight(i.movingItem?i.movingItem.sizeY:0)});var o=g[0].offsetWidth||parseInt(g.css("width"),10),p=function(){var a=g[0].offsetWidth||parseInt(g.css("width"),10);a&&a!==o&&!i.movingItem&&(o=a,i.loaded&&g.removeClass("gridster-loaded"),j(),i.loaded&&g.addClass("gridster-loaded"),d.$broadcast("gridster-resized",[a,g[0].offsetHeight],i))},q=e(function(){p(),b(function(){f.$apply()})},100);f.$watch(function(){return m(g[0])},q),"function"==typeof window.addResizeListener?window.addResizeListener(g[0],q):f.$watch(function(){return g[0].offsetWidth||parseInt(g.css("width"),10)},p);var r=a.element(c);r.on("resize",q),f.$on("$destroy",function(){i.destroy(),r.off("resize",q),"function"==typeof window.removeResizeListener&&window.removeResizeListener(g[0],q)}),b(function(){f.$watch("gridster.floating",function(){i.floatItemsUp()}),i.loaded=!0},100)}}}}]).controller("GridsterItemCtrl",function(){this.$element=null,this.gridster=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.minSizeX=0,this.minSizeY=0,this.maxSizeX=null,this.maxSizeY=null,this.init=function(a,b){this.$element=a,this.gridster=b,this.sizeX=b.defaultSizeX,this.sizeY=b.defaultSizeY},this.destroy=function(){this.gridster=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.gridster.movingItem===this},this.setPosition=function(a,b){this.gridster.putItem(this,a,b),this.isMoving()||this.setElementPosition()},this.setSize=function(a,b,c){a=a.toUpperCase();var d="size"+a,e="Size"+a;if(""!==b){b=parseInt(b,10),(isNaN(b)||0===b)&&(b=this.gridster["default"+e]);var f="X"===a?this.gridster.columns:this.gridster.maxRows;this["max"+e]&&(f=Math.min(this["max"+e],f)),this.gridster["max"+e]&&(f=Math.min(this.gridster["max"+e],f)),"X"===a&&this.cols?f-=this.cols:"Y"===a&&this.rows&&(f-=this.rows);var g=0;this["min"+e]&&(g=Math.max(this["min"+e],g)),this.gridster["min"+e]&&(g=Math.max(this.gridster["min"+e],g)),b=Math.max(Math.min(b,f),g);var h=this[d]!==b||this["old"+e]&&this["old"+e]!==b;return this["old"+e]=this[d]=b,this.isMoving()||this["setElement"+e](),!c&&h&&(this.gridster.moveOverlappingItems(this),this.gridster.layoutChanged()),h}},this.setSizeY=function(a,b){return this.setSize("Y",a,b)},this.setSizeX=function(a,b){return this.setSize("X",a,b)},this.setElementPosition=function(){this.$element.css(this.gridster.isMobile?{marginLeft:this.gridster.margins[0]+"px",marginRight:this.gridster.margins[0]+"px",marginTop:this.gridster.margins[1]+"px",marginBottom:this.gridster.margins[1]+"px",top:"",left:""}:{margin:0,top:this.row*this.gridster.curRowHeight+(this.gridster.outerMargin?this.gridster.margins[0]:0)+"px",left:this.col*this.gridster.curColWidth+(this.gridster.outerMargin?this.gridster.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.gridster.isMobile&&!this.gridster.saveGridItemCalculatedHeightInMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]+"px")},this.setElementSizeX=function(){this.gridster.isMobile?this.$element.css("width",""):this.$element.css("width",this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]+"px")},this.getElementSizeX=function(){return this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]},this.getElementSizeY=function(){return this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]}}).factory("GridsterTouch",[function(){return function(a,b,c,d){var e,f,g={},h=function(a){if(Object.keys)return Object.keys(a).length;var b,c=0;for(b in a)++c;return c},i=function(a){for(var b=0,c=0,d=navigator.userAgent.match(/\bMSIE\b/),e=a;null!=e;e=e.offsetParent)d&&(!document.documentMode||document.documentMode<8)&&"relative"===e.currentStyle.position&&e.offsetParent&&"relative"===e.offsetParent.currentStyle.position&&e.offsetLeft===e.offsetParent.offsetLeft?c+=e.offsetTop:(b+=e.offsetLeft,c+=e.offsetTop);return{x:b,y:c}},j=i(a),k=function(e){if("mousemove"!==e.type||0!==h(g)){for(var f=!0,m=e.changedTouches?e.changedTouches:[e],n=0;n<m.length;++n){var o=m[n],p="undefined"!=typeof o.identifier?o.identifier:"undefined"!=typeof o.pointerId?o.pointerId:1;if("undefined"==typeof o.pageX)if(o.pageX=o.offsetX+j.x,o.pageY=o.offsetY+j.y,o.srcElement.offsetParent===a&&document.documentMode&&8===document.documentMode&&"mousedown"===o.type)o.pageX+=o.srcElement.offsetLeft,o.pageY+=o.srcElement.offsetTop;else if(o.srcElement!==a&&!document.documentMode||document.documentMode<8){for(var q=-2,r=-2,s=o.srcElement;null!==s;s=s.parentNode)q+=s.scrollLeft?s.scrollLeft:0,r+=s.scrollTop?s.scrollTop:0;o.pageX=o.clientX+q,o.pageY=o.clientY+r}var t=o.pageX,u=o.pageY;e.type.match(/(start|down)$/i)?(j=i(a),g[p]&&(d&&d({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u}),delete g[p]),b&&f&&(f=b({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u})),g[p]={x:t,y:u},a.msSetPointerCapture?a.msSetPointerCapture(p):"mousedown"===e.type&&1===h(g)&&(l?a.setCapture(!0):(document.addEventListener("mousemove",k,!1),document.addEventListener("mouseup",k,!1)))):e.type.match(/move$/i)?!g[p]||g[p].x===t&&g[p].y===u||(c&&f&&(f=c({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u})),g[p].x=t,g[p].y=u):g[p]&&e.type.match(/(up|end|cancel)$/i)&&(d&&f&&(f=d({target:e.target,which:e.which,pointerId:p,pageX:t,pageY:u})),delete g[p],a.msReleasePointerCapture?a.msReleasePointerCapture(p):"mouseup"===e.type&&0===h(g)&&(l?a.releaseCapture():(document.removeEventListener("mousemove",k,!1),document.removeEventListener("mouseup",k,!1))))}f&&(e.preventDefault&&e.preventDefault(),e.preventManipulation&&e.preventManipulation(),e.preventMouseEvent&&e.preventMouseEvent())}},l=!1;return this.enable=function(){window.navigator.msPointerEnabled?(a.addEventListener("MSPointerDown",k,!1),a.addEventListener("MSPointerMove",k,!1),a.addEventListener("MSPointerUp",k,!1),a.addEventListener("MSPointerCancel",k,!1),"undefined"!=typeof a.style.msContentZooming&&(e=a.style.msContentZooming,a.style.msContentZooming="none"),"undefined"!=typeof a.style.msTouchAction&&(f=a.style.msTouchAction,a.style.msTouchAction="none")):a.addEventListener?(a.addEventListener("touchstart",k,!1),a.addEventListener("touchmove",k,!1),a.addEventListener("touchend",k,!1),a.addEventListener("touchcancel",k,!1),a.addEventListener("mousedown",k,!1),a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(l=!0,a.addEventListener("mousemove",k,!1),a.addEventListener("mouseup",k,!1))):a.attachEvent&&a.setCapture&&(l=!0,a.attachEvent("onmousedown",function(){return k(window.event),window.event.returnValue=!1,!1}),a.attachEvent("onmousemove",function(){return k(window.event),window.event.returnValue=!1,!1}),a.attachEvent("onmouseup",function(){return k(window.event),window.event.returnValue=!1,!1}))},this.disable=function(){window.navigator.msPointerEnabled?(a.removeEventListener("MSPointerDown",k,!1),a.removeEventListener("MSPointerMove",k,!1),a.removeEventListener("MSPointerUp",k,!1),a.removeEventListener("MSPointerCancel",k,!1),e&&(a.style.msContentZooming=e),f&&(a.style.msTouchAction=f)):a.removeEventListener?(a.removeEventListener("touchstart",k,!1),a.removeEventListener("touchmove",k,!1),a.removeEventListener("touchend",k,!1),a.removeEventListener("touchcancel",k,!1),a.removeEventListener("mousedown",k,!1),a.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(l=!0,a.removeEventListener("mousemove",k,!1),a.removeEventListener("mouseup",k,!1))):a.detachEvent&&a.setCapture&&(l=!0,a.detachEvent("onmousedown"),a.detachEvent("onmousemove"),a.detachEvent("onmouseup"))},this}}]).factory("GridsterDraggable",["$document","$timeout","$window","GridsterTouch",function(b,c,d,e){function f(f,g,h,i,j){function k(b){if(-1!==G.indexOf(b.target.nodeName.toLowerCase()))return!1;var c=a.element(b.target);if(c.hasClass("gridster-item-resizable-handler"))return!1;if(c.attr("onclick")||c.attr("ng-click"))return!1;if(c.closest&&c.closest(".gridster-no-drag").length)return!1;switch(b.which){case 1:break;case 2:case 3:return}return y=b.pageX,z=b.pageY,q=parseInt(f.css("left"),10),r=parseInt(f.css("top"),10),s=f[0].offsetWidth,t=f[0].offsetHeight,u=i.col,v=i.row,n(b),!0}function l(a){if(!f.hasClass("gridster-item-moving")||f.hasClass("gridster-item-resizing"))return!1;var b=h.curWidth-1;null!=h.maxRows&&(D=h.rowsToPixels(h.maxRows)+(h.outerMargin?+h.margins[0]:h.margins[0])),w=a.pageX,x=a.pageY;var c=w-y+A,d=x-z+B;A=B=0,y=w,z=x;var e=c,g=d;return E>q+e?(c=E-q,A=e-c):q+s+e>b&&(c=b-q-s,A=e-c),C>r+g?(d=C-r,B=g-d):r+t+g>D&&(d=D-r-t,B=g-d),q+=c,r+=d,f.css({top:r+"px",left:q+"px"}),o(a),!0}function m(a){return!f.hasClass("gridster-item-moving")||f.hasClass("gridster-item-resizing")?!1:(A=B=0,p(a),!0)}function n(a){f.addClass("gridster-item-moving"),h.movingItem=i,h.updateHeight(i.sizeY),g.$apply(function(){h.draggable&&h.draggable.start&&h.draggable.start(a,f,j)})}function o(a){var b=i.row,c=i.col,e=h.draggable&&h.draggable.drag,k=h.draggable.scrollSensitivity,l=h.draggable.scrollSpeed,m=h.pixelsToRows(r),n=h.pixelsToColumns(q),o=h.getItems(m,n,i.sizeX,i.sizeY,i),p=0!==o.length;if(h.swapping===!0&&p){var s=h.getBoundingBox(o),t=s.sizeX===i.sizeX&&s.sizeY===i.sizeY,u=s.row===b,v=s.col===c,w=s.row===m&&s.col===n,x=u||v;if(t&&1===o.length){if(w)h.swapItems(i,o[0]);else if(x)return}else if(s.sizeX<=i.sizeX&&s.sizeY<=i.sizeY&&x)for(var y=i.row<=m?i.row:m+i.sizeY,z=i.col<=n?i.col:n+i.sizeX,A=y-s.row,B=z-s.col,C=0,D=o.length;D>C;++C){var E=o[C],G=h.getItems(E.row+A,E.col+B,E.sizeX,E.sizeY,i);0===G.length&&h.putItem(E,E.row+A,E.col+B)}}var H=!0;p&&(H=h.itemsInTheWayCanFit(o,m,n,i)),h.pushing===!1&&p||!H||(i.row=m,i.col=n),a.pageY-F.body.scrollTop<k?F.body.scrollTop=F.body.scrollTop-l:d.innerHeight-(a.pageY-F.body.scrollTop)<k&&(F.body.scrollTop=F.body.scrollTop+l),a.pageX-F.body.scrollLeft<k?F.body.scrollLeft=F.body.scrollLeft-l:d.innerWidth-(a.pageX-F.body.scrollLeft)<k&&(F.body.scrollLeft=F.body.scrollLeft+l),(e||b!==i.row||c!==i.col)&&g.$apply(function(){e&&h.draggable.drag(a,f,j)})}function p(a){f.removeClass("gridster-item-moving");var b=h.pixelsToRows(r),c=h.pixelsToColumns(q),d=h.getItems(b,c,i.sizeX,i.sizeY,i),e=0!==d.length,k=!0;e&&(k=h.itemsInTheWayCanFit(d,b,c,i)),h.pushing===!1&&e||!k||(i.row=b,i.col=c),h.movingItem=null,i.setPosition(i.row,i.col),g.$apply(function(){h.draggable&&h.draggable.stop&&h.draggable.stop(a,f,j)})}var q,r,s,t,u,v,w=0,x=0,y=0,z=0,A=0,B=0,C=0,D=9999,E=0,F=b[0],G=["select","input","textarea","button"],H=null,I=null,J=[];this.enable=function(){H!==!0&&c(function(){for(var b=0,c=J.length;c>b;++b)J[b].disable();J=[],h.draggable&&h.draggable.handle?(I=a.element(f[0].querySelectorAll(h.draggable.handle)),0===I.length&&(I=f)):I=f;for(var d=0,g=I.length;g>d;++d)J[d]=new e(I[d],k,l,m),J[d].enable();H=!0})},this.disable=function(){H!==!1&&c(function(){for(var a=0,b=J.length;b>a;++a)J[a].disable();J=[],H=!1})},this.toggle=function(a){a?this.enable():this.disable()},this.destroy=function(){this.disable()}}return f}]).factory("GridsterResizable",["GridsterTouch",function(b){function c(c,d,e,f,g){function h(h){function i(a){switch(a.which){case 1:break;case 2:case 3:return}return u=e.draggable.enabled,u&&(e.draggable.enabled=!1,d.$broadcast("gridster-draggable-changed",e)),z=a.pageX,A=a.pageY,o=parseInt(c.css("left"),10),p=parseInt(c.css("top"),10),q=c[0].offsetWidth,r=c[0].offsetHeight,s=f.sizeX,t=f.sizeY,j(a),!0}function j(a){c.addClass("gridster-item-moving"),c.addClass("gridster-item-resizing"),e.movingItem=f,f.setElementSizeX(),f.setElementSizeY(),f.setElementPosition(),e.updateHeight(1),d.$apply(function(){e.resizable&&e.resizable.start&&e.resizable.start(a,c,g)})}function k(a){var b=e.curWidth-1;x=a.pageX,y=a.pageY;var d=x-z+B,f=y-A+C;B=C=0,z=x,A=y;var g=f,h=d;return w.indexOf("n")>=0&&(r-g<G()?(f=r-G(),C=g-f):D>p+g&&(f=D-p,C=g-f),p+=f,r-=f),w.indexOf("s")>=0&&(r+g<G()?(f=G()-r,C=g-f):p+r+g>E&&(f=E-p-r,C=g-f),r+=f),w.indexOf("w")>=0&&(q-h<H()?(d=q-H(),B=h-d):F>o+h&&(d=F-o,B=h-d),o+=d,q-=d),w.indexOf("e")>=0&&(q+h<H()?(d=H()-q,B=h-d):o+q+h>b&&(d=b-o-q,B=h-d),q+=d),c.css({top:p+"px",left:o+"px",width:q+"px",height:r+"px"}),m(a),!0}function l(a){return e.draggable.enabled!==u&&(e.draggable.enabled=u,d.$broadcast("gridster-draggable-changed",e)),B=C=0,n(a),!0}function m(a){var b=f.row,i=f.col,j=f.sizeX,k=f.sizeY,l=e.resizable&&e.resizable.resize,m=f.col;-1!==["w","nw","sw"].indexOf(h)&&(m=e.pixelsToColumns(o,!1));var n=f.row;-1!==["n","ne","nw"].indexOf(h)&&(n=e.pixelsToRows(p,!1));var s=f.sizeX;-1===["n","s"].indexOf(h)&&(s=e.pixelsToColumns(q,!0));var t=f.sizeY;-1===["e","w"].indexOf(h)&&(t=e.pixelsToRows(r,!0));var u=n>-1&&m>-1&&s+m<=e.columns&&t+n<=e.maxRows;!u||e.pushing===!1&&0!==e.getItems(n,m,s,t,f).length||(f.row=n,f.col=m,f.sizeX=s,f.sizeY=t);var v=f.row!==b||f.col!==i||f.sizeX!==j||f.sizeY!==k;(l||v)&&d.$apply(function(){l&&e.resizable.resize(a,c,g)})}function n(a){c.removeClass("gridster-item-moving"),c.removeClass("gridster-item-resizing"),e.movingItem=null,f.setPosition(f.row,f.col),f.setSizeY(f.sizeY),f.setSizeX(f.sizeX),d.$apply(function(){e.resizable&&e.resizable.stop&&e.resizable.stop(a,c,g)})}var o,p,q,r,s,t,u,v,w=h,x=0,y=0,z=0,A=0,B=0,C=0,D=0,E=9999,F=0,G=function(){return(f.minSizeY?f.minSizeY:1)*e.curRowHeight-e.margins[0]},H=function(){return(f.minSizeX?f.minSizeX:1)*e.curColWidth-e.margins[1]},I=null;this.enable=function(){I||(I=a.element('<div class="gridster-item-resizable-handler handle-'+w+'"></div>'),c.append(I)),v=new b(I[0],i,k,l),v.enable()},this.disable=function(){I&&(I.remove(),I=null),v.disable(),v=void 0},this.destroy=function(){this.disable()}}var i=[],j=e.resizable.handles;"string"==typeof j&&(j=e.resizable.handles.split(","));for(var k=!1,l=0,m=j.length;m>l;l++)i.push(new h(j[l]));this.enable=function(){if(!k){for(var a=0,b=i.length;b>a;a++)i[a].enable();k=!0}},this.disable=function(){if(k){for(var a=0,b=i.length;b>a;a++)i[a].disable();k=!1}},this.toggle=function(a){a?this.enable():this.disable()},this.destroy=function(){for(var a=0,b=i.length;b>a;a++)i[a].destroy()}}return c}]).factory("gridsterDebounce",function(){return function(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}}).directive("gridsterItem",["$parse","GridsterDraggable","GridsterResizable","gridsterDebounce","$rootScope",function(a,b,c,d,e){return{scope:!0,restrict:"EA",controller:"GridsterItemCtrl",controllerAs:"gridsterItem",require:["^gridster","gridsterItem"],link:function(f,g,h,i){function j(){p.setPosition(p.row,p.col),s.row&&s.row.assign&&s.row.assign(f,p.row),s.col&&s.col.assign&&s.col.assign(f,p.col)}function k(){var a=p.setSizeX(p.sizeX,!0);a&&s.sizeX&&s.sizeX.assign&&s.sizeX.assign(f,p.sizeX);var b=p.setSizeY(p.sizeY,!0);b&&s.sizeY&&s.sizeY.assign&&s.sizeY.assign(f,p.sizeY),(a||b)&&(p.gridster.moveOverlappingItems(p),o.layoutChanged(),f.$broadcast("gridster-item-resized",p))}function l(){var a=document.createElement("div"),b={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var c in b)if(void 0!==a.style[c])return b[c]}var m,n=h.gridsterItem,o=i[0],p=i[1];if(f.gridster=o,n){var q=a(n);if(m=q(f)||{},!m&&q.assign)m={row:p.row,col:p.col,sizeX:p.sizeX,sizeY:p.sizeY,minSizeX:0,minSizeY:0,maxSizeX:null,maxSizeY:null},q.assign(f,m);else if(p.id=m.id,m.sizeY>f.gridster.maxRows||m.sizeX>f.gridster.columns)return void e.$broadcast("gridster-item-unplaceable",p)}else m=h;p.init(g,o),g.addClass("gridster-item");for(var r=["minSizeX","maxSizeX","minSizeY","maxSizeY","sizeX","sizeY","row","col"],s={},t=[],u=function(b){var c;if("string"==typeof m[b])c=m[b];else if("string"==typeof m[b.toLowerCase()])c=m[b.toLowerCase()];else{if(!n)return;c=n+"."+b}t.push('"'+b+'":'+c),s[b]=a(c);var d=s[b](f);"number"==typeof d&&(p[b]=d)},v=0,w=r.length;w>v;++v)u(r[v]);var x="{"+t.join(",")+"}";f.$watchCollection(x,function(a,b){for(var c in a){var d=a[c],e=b[c];e!==d&&(d=parseInt(d,10),isNaN(d)||(p[c]=d))}}),f.$watch(function(){return p.row+","+p.col},j),f.$watch(function(){return p.sizeY+","+p.sizeX+","+p.minSizeX+","+p.maxSizeX+","+p.minSizeY+","+p.maxSizeY},k);var y=new b(g,f,o,p,m),z=new c(g,f,o,p,m),A=function(){z.toggle(!o.isMobile&&o.resizable&&o.resizable.enabled)};A();var B=function(){y.toggle(!o.isMobile&&o.draggable&&o.draggable.enabled)};B(),f.$on("gridster-draggable-changed",B),f.$on("gridster-resizable-changed",A),f.$on("gridster-resized",A),f.$on("gridster-mobile-changed",function(){A(),B()});var C=d(function(){f.$apply(function(){f.$broadcast("gridster-item-transition-end",p)})},50);return g.on(l(),C),f.$broadcast("gridster-item-initialized",p),f.$on("$destroy",function(){try{z.destroy(),y.destroy()}catch(a){}try{o.removeItem(p)}catch(a){}try{p.destroy()}catch(a){}})}}}]).directive("gridsterNoDrag",function(){return{restrict:"A",link:function(a,b){b.addClass("gridster-no-drag")}}})});