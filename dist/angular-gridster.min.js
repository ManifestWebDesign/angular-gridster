/*
 * angular-gridster
 * http://manifestwebdesign.github.io/angular-gridster
 *
 * @version: 0.13.2
 * @license: MIT
 */
!function(e){"use strict";e.module("gridster",[]).constant("gridsterConfig",{columns:6,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"match",margins:[10,10],outerMargin:!0,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:100,fixRows:!1,gridsterLayout:!1,headers:[],defaultSizeX:2,defaultSizeY:1,minSizeX:1,maxSizeX:null,minSizeY:1,maxSizeY:null,saveGridItemCalculatedHeightInMobile:!1,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0,scrollSensitivity:20,scrollSpeed:15}}).controller("GridsterCtrl",["gridsterConfig","$timeout","$rootScope",function(t,i,r){var s=this;e.extend(this,t),this.resizable=e.extend({},t.resizable||{}),this.draggable=e.extend({},t.draggable||{});var n=!1;this.layoutChanged=function(){n||(n=!0,i(function(){n=!1,s.loaded&&s.floatItemsUp(),s.updateHeight(s.movingItem?s.movingItem.sizeY:0)},30))},this.grid=[],this.destroy=function(){this.grid&&(this.grid.length=0,this.grid=null),this.$element=null},this.setOptions=function(t){if(t)if(t=e.extend({},t),t.draggable&&(e.extend(this.draggable,t.draggable),delete t.draggable),t.resizable&&(e.extend(this.resizable,t.resizable),delete t.resizable),e.extend(this,t),this.margins&&2===this.margins.length)for(var i=0,r=this.margins.length;r>i;++i)this.margins[i]=parseInt(this.margins[i],10),isNaN(this.margins[i])&&(this.margins[i]=0);else this.margins=[0,0]},this.canItemOccupy=function(e,t,i){return t>-1&&i>-1&&e.sizeX+i<=this.columns&&e.sizeY+t<=this.maxRows},this.autoSetItemPosition=function(e){for(var t=0;t<this.maxRows;++t)for(var i=0;i<this.columns;++i){var s=this.getItems(t,i,e.sizeX,e.sizeY,e);if(0===s.length&&this.canItemOccupy(e,t,i))return void this.putItem(e,t,i)}r.$broadcast("gridster-item-unplaceable",e)},this.getItems=function(e,t,i,r,s){var n=[];i&&r||(i=r=1),!s||s instanceof Array||(s=[s]);for(var o=0;r>o;++o)for(var a=0;i>a;++a){var l=this.getItem(e+o,t+a,s);!l||s&&-1!==s.indexOf(l)||-1!==n.indexOf(l)||n.push(l)}return n},this.getBoundingBox=function(e){if(0===e.length)return null;if(1===e.length)return{row:e[0].row,col:e[0].col,sizeY:e[0].sizeY,sizeX:e[0].sizeX};for(var t=0,i=0,r=9999,s=9999,n=0,o=e.length;o>n;++n){var a=e[n];r=Math.min(a.row,r),s=Math.min(a.col,s),t=Math.max(a.row+a.sizeY,t),i=Math.max(a.col+a.sizeX,i)}return{row:r,col:s,sizeY:t-r,sizeX:i-s}},this.removeItem=function(e){for(var t=0,i=this.grid.length;i>t;++t){var r=this.grid[t];if(r){var s=r.indexOf(e);if(-1!==s){r[s]=null;break}}}this.layoutChanged()},this.getItem=function(e,t,i){!i||i instanceof Array||(i=[i]);for(var r=1;e>-1;){for(var s=1,n=t;n>-1;){var o=this.grid[e];if(o){var a=o[n];if(a&&(!i||-1===i.indexOf(a))&&a.sizeX>=s&&a.sizeY>=r)return a}++s,--n}--e,++r}return null},this.putItems=function(e){for(var t=0,i=e.length;i>t;++t)this.putItem(e[t])},this.putItem=function(e,t,i,r){if(("undefined"==typeof t||null===t)&&(t=e.row,i=e.col,"undefined"==typeof t||null===t))return void this.autoSetItemPosition(e);if(this.canItemOccupy(e,t,i)||(i=Math.min(this.columns-e.sizeX,Math.max(0,i)),t=Math.min(this.maxRows-e.sizeY,Math.max(0,t))),null!==e.oldRow&&"undefined"!=typeof e.oldRow){var s=e.oldRow===t&&e.oldColumn===i,n=this.grid[t]&&this.grid[t][i]===e;if(s&&n)return e.row=t,void(e.col=i);var o=this.grid[e.oldRow];o&&o[e.oldColumn]===e&&delete o[e.oldColumn]}e.oldRow=e.row=t,e.oldColumn=e.col=i,this.moveOverlappingItems(e,r),this.grid[t]||(this.grid[t]=[]),this.grid[t][i]=e,this.movingItem===e&&this.floatItemUp(e),this.layoutChanged()},this.swapItems=function(e,t){this.grid[e.row][e.col]=t,this.grid[t.row][t.col]=e;var i=e.row,r=e.col;e.row=t.row,e.col=t.col,t.row=i,t.col=r},this.moveOverlappingItems=function(e,t){t?-1===t.indexOf(e)&&(t=t.slice(0),t.push(e)):t=[e];var i=this.getItems(e.row,e.col,e.sizeX,e.sizeY,t);this.moveItemsDown(i,e.row+e.sizeY,t)},this.moveItemsDown=function(e,t,i){if(e&&0!==e.length){e.sort(function(e,t){return e.row-t.row}),i=i?i.slice(0):[];var r,s,n,o={};for(s=0,n=e.length;n>s;++s){r=e[s];var a=o[r.col];("undefined"==typeof a||r.row<a)&&(o[r.col]=r.row)}for(s=0,n=e.length;n>s;++s){r=e[s];var l=t-o[r.col];this.moveItemDown(r,r.row+l,i),i.push(r)}}},this.moveItemDown=function(e,t,i){if(!(e.row>=t)){for(;e.row<t;)++e.row,this.moveOverlappingItems(e,i);this.putItem(e,e.row,e.col,i)}},this.floatItemsUp=function(){if(this.floating!==!1)for(var e=0,t=this.grid.length;t>e;++e){var i=this.grid[e];if(i)for(var r=0,s=i.length;s>r;++r){var n=i[r];n&&this.floatItemUp(n)}}},this.floatItemUp=function(e){if(this.floating!==!1){for(var t=e.col,i=e.sizeY,r=e.sizeX,s=null,n=null,o=e.row-1;o>-1;){var a=this.getItems(o,t,r,i,e);if(0!==a.length)break;s=o,n=t,--o}null!==s&&this.putItem(e,s,n)}},this.itemsInTheWayCanFit=function(e,t,i,r){for(var s=!0,n=0,o=0,a=e.length;a>o;++o){var l=e[o];if(n+=l.sizeY,t+r.sizeY+l.sizeY>this.maxRows)return!1;var d=this.getItems(t+r.sizeY,i,l.sizeX,l.sizeY,l),g=0!==d.length;g&&(s=this.itemsInTheWayCanFit(d,t+r.sizeY,i,l))}return t+r.sizeY+n>this.maxRows?!1:s},this.updateHeight=function(e){var t=this.minRows;if(this.fixRows)return void(this.gridHeight=this.maxRows);e=e||0;for(var i=this.grid.length;i>=0;--i){var r=this.grid[i];if(r)for(var s=0,n=r.length;n>s;++s)r[s]&&(t=Math.max(t,i+e+r[s].sizeY))}var o=this.maxRows-t>0?Math.min(this.maxRows,t):Math.max(this.maxRows,t);o>this.maxRows&&(o=this.maxRows),this.gridHeight=o},this.pixelsToRows=function(e,t){return t===!0?Math.ceil(e/this.curRowHeight):t===!1?Math.floor(e/this.curRowHeight):Math.round(e/this.curRowHeight)},this.rowsToPixels=function(e,t){return t===!0?Math.ceil(e*this.curRowHeight):t===!1?Math.floor(e+this.curRowHeight):Math.round(e*this.curRowHeight)},this.pixelsToColumns=function(e,t){return t===!0?Math.ceil(e/this.curColWidth):t===!1?Math.floor(e/this.curColWidth):Math.round(e/this.curColWidth)}}]).directive("gridsterLayout",function(){return{restrict:"E",template:'<div class="grid-layout"><div ng-if="gridster.headers.length>0" class="headers" style="top:-{{gridster.headersHeight}}px;"><div ng-repeat="header in gridster.headers" class="row-header" style="height: {{gridster.curRowHeight}}px;width: {{gridster.curColWidth-gridster.margins[1]}}px;">{{header}}</div></div><div ng-repeat="column in range(gridster.columns) track by $index" class="column" style="width: {{gridster.curColWidth-gridster.margins[1]}}px; margin-left: {{gridster.margins[1]}}px; margin-top: {{gridster.margins[0]}}px;"><div ng-repeat="row in range(gridster.maxRows-1) track by $index" class="row" style="height: {{gridster.curRowHeight}}px;"></div></div></div>',scope:!0,require:"^gridster",link:function(e,t,i,r){e.range=function(e){return new Array(+e)},r.curRowHeight=r.rowHeight,"string"==typeof r.rowHeight&&("match"===r.rowHeight?r.curRowHeight=Math.round(r.curColWidth):-1!==r.rowHeight.indexOf("*")?r.curRowHeight=Math.round(r.curColWidth*r.rowHeight.replace("*","").replace(" ","")):-1!==r.rowHeight.indexOf("/")&&(r.curRowHeight=Math.round(r.curColWidth/r.rowHeight.replace("/","").replace(" ","")))),r.headers.length>0&&(r.headersHeight=30,r.curRowHeight>30&&(r.headersHeight=r.curRowHeight),r.$element[0].style.top=r.headersHeight+"px",r.$element[0].style.marginBottom=r.headersHeight+"px"),r.curColWidth="auto"===r.colWidth?(r.curWidth+(r.outerMargin?-r.margins[1]:r.margins[1]))/r.columns:r.colWidth}}}).directive("gridsterPreview",function(){return{replace:!0,scope:!0,require:"^gridster",template:'<div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div>',link:function(e,t,i,r){e.previewStyle=function(){return r.movingItem?{display:"block",height:r.movingItem.sizeY*r.curRowHeight-r.margins[0]+"px",width:r.movingItem.sizeX*r.curColWidth-r.margins[1]+"px",top:r.movingItem.row*r.curRowHeight+(r.outerMargin?r.margins[0]:0)+"px",left:r.movingItem.col*r.curColWidth+(r.outerMargin?r.margins[1]:0)+"px"}:{display:"none"}}}}}).directive("gridster",["$timeout","$window","$rootScope","gridsterDebounce",function(t,i,r,s){return{scope:!0,restrict:"EAC",controller:"GridsterCtrl",controllerAs:"gridster",compile:function(n){return n.prepend('<gridster-layout ng-if="gridster.gridsterLayout"></gridster-layout>'),n.prepend('<div ng-if="gridster.movingItem" gridster-preview></div>'),function(n,o,a,l){function d(e){l.setOptions(e),l.curWidth="auto"===l.width?o[0].offsetWidth||parseInt(o.css("width"),10):"match"===l.width?"auto"===l.colWidth?o[0].offsetWidth||parseInt(o.css("width"),10):l.colWidth*l.columns+(l.outerMargin?+l.margins[1]:l.margins[1]):l.width,l.curColWidth="auto"===l.colWidth?(l.curWidth+(l.outerMargin?-l.margins[1]:l.margins[1]))/l.columns:l.colWidth,l.curRowHeight=l.rowHeight,"string"==typeof l.rowHeight&&("match"===l.rowHeight?l.curRowHeight=Math.round(l.curColWidth):-1!==l.rowHeight.indexOf("*")?l.curRowHeight=Math.round(l.curColWidth*l.rowHeight.replace("*","").replace(" ","")):-1!==l.rowHeight.indexOf("/")&&(l.curRowHeight=Math.round(l.curColWidth/l.rowHeight.replace("/","").replace(" ","")))),l.isMobile=l.mobileModeEnabled&&l.curWidth<=l.mobileBreakPoint;for(var t=0,i=l.grid.length;i>t;++t){var r=l.grid[t];if(r)for(var s=0,n=r.length;n>s;++s)if(r[s]){var a=r[s];a.setElementPosition(),a.setElementSizeY(),a.setElementSizeX()}}g()}function g(){o.css("height",l.gridHeight*l.curRowHeight+(l.outerMargin?l.margins[0]:-l.margins[0])+"px")}function h(){"match"===l.width&&o.css("width",l.curWidth+"px")}l.loaded=!1,l.$element=o,n.gridster=l,o.addClass("gridster");var c=a.gridster;c?n.$parent.$watch(c,function(e){d(e)},!0):d({}),n.$watch(function(){return l.loaded},function(){l.loaded?o.addClass("gridster-loaded"):o.removeClass("gridster-loaded")}),n.$watch(function(){return l.isMobile},function(){l.isMobile?o.addClass("gridster-mobile").removeClass("gridster-desktop"):o.removeClass("gridster-mobile").addClass("gridster-desktop"),r.$broadcast("gridster-mobile-changed",l)}),n.$watch(function(){return l.draggable},function(){r.$broadcast("gridster-draggable-changed",l)},!0),n.$watch(function(){return l.resizable},function(){r.$broadcast("gridster-resizable-changed",l)},!0),n.$watch(function(){return l.gridHeight},g),n.$watch(function(){return l.curWidth},h),n.$watch(function(){return l.movingItem},function(){l.updateHeight(l.movingItem?l.movingItem.sizeY:0)});var u=o[0].offsetWidth||parseInt(o.css("width"),10),m=function(){var e=o[0].offsetWidth||parseInt(o.css("width"),10);e&&e!==u&&!l.movingItem&&(u=e,l.loaded&&o.removeClass("gridster-loaded"),d(),l.loaded&&o.addClass("gridster-loaded"),r.$broadcast("gridster-resized",[e,o[0].offsetHeight],l))},f=s(function(){m(),t(function(){n.$apply()})},100);"function"==typeof o.resize?o.resize(f):"function"==typeof window.addResizeListener?window.addResizeListener(o[0],f):n.$watch(function(){return o[0].offsetWidth||parseInt(o.css("width"),10)},m);var p=e.element(i);p.on("resize",f),n.$on("$destroy",function(){l.destroy(),p.off("resize",f),"function"==typeof window.removeResizeListener&&window.removeResizeListener(o[0],f)}),t(function(){n.$watch("gridster.floating",function(){l.floatItemsUp()}),l.loaded=!0},100)}}}}]).controller("GridsterItemCtrl",function(){this.$element=null,this.gridster=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.minSizeX=0,this.minSizeY=0,this.maxSizeX=null,this.maxSizeY=null,this.init=function(e,t){this.$element=e,this.gridster=t,this.sizeX=t.defaultSizeX,this.sizeY=t.defaultSizeY},this.destroy=function(){this.gridster=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.gridster.movingItem===this},this.setPosition=function(e,t){this.gridster.putItem(this,e,t),this.isMoving()||this.setElementPosition()},this.setSize=function(e,t,i){e=e.toUpperCase();var r="size"+e,s="Size"+e;if(""!==t){t=parseInt(t,10),(isNaN(t)||0===t)&&(t=this.gridster["default"+s]);var n="X"===e?this.gridster.columns:this.gridster.maxRows;this["max"+s]&&(n=Math.min(this["max"+s],n)),this.gridster["max"+s]&&(n=Math.min(this.gridster["max"+s],n)),"X"===e&&this.cols?n-=this.cols:"Y"===e&&this.rows&&(n-=this.rows);var o=0;this["min"+s]&&(o=Math.max(this["min"+s],o)),this.gridster["min"+s]&&(o=Math.max(this.gridster["min"+s],o)),t=Math.max(Math.min(t,n),o);var a=this[r]!==t||this["old"+s]&&this["old"+s]!==t;return this["old"+s]=this[r]=t,this.isMoving()||this["setElement"+s](),!i&&a&&(this.gridster.moveOverlappingItems(this),this.gridster.layoutChanged()),a}},this.setSizeY=function(e,t){return this.setSize("Y",e,t)},this.setSizeX=function(e,t){return this.setSize("X",e,t)},this.setElementPosition=function(){this.$element.css(this.gridster.isMobile?{marginLeft:this.gridster.margins[0]+"px",marginRight:this.gridster.margins[0]+"px",marginTop:this.gridster.margins[1]+"px",marginBottom:this.gridster.margins[1]+"px",top:"",left:""}:{margin:0,top:this.row*this.gridster.curRowHeight+(this.gridster.outerMargin?this.gridster.margins[0]:0)+"px",left:this.col*this.gridster.curColWidth+(this.gridster.outerMargin?this.gridster.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.gridster.isMobile&&!this.gridster.saveGridItemCalculatedHeightInMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]+"px")},this.setElementSizeX=function(){this.gridster.isMobile?this.$element.css("width",""):this.$element.css("width",this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]+"px")},this.getElementSizeX=function(){return this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]},this.getElementSizeY=function(){return this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]}}).factory("GridsterTouch",[function(){return function(e,t,i,r){var s,n,o={},a=function(e){if(Object.keys)return Object.keys(e).length;var t,i=0;for(t in e)++i;return i},l=function(e){for(var t=0,i=0,r=navigator.userAgent.match(/\bMSIE\b/),s=e;null!=s;s=s.offsetParent)r&&(!document.documentMode||document.documentMode<8)&&"relative"===s.currentStyle.position&&s.offsetParent&&"relative"===s.offsetParent.currentStyle.position&&s.offsetLeft===s.offsetParent.offsetLeft?i+=s.offsetTop:(t+=s.offsetLeft,i+=s.offsetTop);return{x:t,y:i}},d=l(e),g=function(s){if("mousemove"!==s.type||0!==a(o)){for(var n=!0,c=s.changedTouches?s.changedTouches:[s],u=0;u<c.length;++u){var m=c[u],f="undefined"!=typeof m.identifier?m.identifier:"undefined"!=typeof m.pointerId?m.pointerId:1;if("undefined"==typeof m.pageX)if(m.pageX=m.offsetX+d.x,m.pageY=m.offsetY+d.y,m.srcElement.offsetParent===e&&document.documentMode&&8===document.documentMode&&"mousedown"===m.type)m.pageX+=m.srcElement.offsetLeft,m.pageY+=m.srcElement.offsetTop;else if(m.srcElement!==e&&!document.documentMode||document.documentMode<8){for(var p=-2,v=-2,w=m.srcElement;null!==w;w=w.parentNode)p+=w.scrollLeft?w.scrollLeft:0,v+=w.scrollTop?w.scrollTop:0;m.pageX=m.clientX+p,m.pageY=m.clientY+v}var z=m.pageX,b=m.pageY;s.type.match(/(start|down)$/i)?(d=l(e),o[f]&&(r&&r({target:s.target,which:s.which,pointerId:f,pageX:z,pageY:b}),delete o[f]),t&&n&&(n=t({target:s.target,which:s.which,pointerId:f,pageX:z,pageY:b})),o[f]={x:z,y:b},e.msSetPointerCapture?e.msSetPointerCapture(f):"mousedown"===s.type&&1===a(o)&&(h?e.setCapture(!0):(document.addEventListener("mousemove",g,!1),document.addEventListener("mouseup",g,!1)))):s.type.match(/move$/i)?!o[f]||o[f].x===z&&o[f].y===b||(i&&n&&(n=i({target:s.target,which:s.which,pointerId:f,pageX:z,pageY:b})),o[f].x=z,o[f].y=b):o[f]&&s.type.match(/(up|end|cancel)$/i)&&(r&&n&&(n=r({target:s.target,which:s.which,pointerId:f,pageX:z,pageY:b})),delete o[f],e.msReleasePointerCapture?e.msReleasePointerCapture(f):"mouseup"===s.type&&0===a(o)&&(h?e.releaseCapture():(document.removeEventListener("mousemove",g,!1),document.removeEventListener("mouseup",g,!1))))}n&&(s.preventDefault&&s.preventDefault(),s.preventManipulation&&s.preventManipulation(),s.preventMouseEvent&&s.preventMouseEvent())}},h=!1;return this.enable=function(){window.navigator.msPointerEnabled?(e.addEventListener("MSPointerDown",g,!1),e.addEventListener("MSPointerMove",g,!1),e.addEventListener("MSPointerUp",g,!1),e.addEventListener("MSPointerCancel",g,!1),"undefined"!=typeof e.style.msContentZooming&&(s=e.style.msContentZooming,e.style.msContentZooming="none"),"undefined"!=typeof e.style.msTouchAction&&(n=e.style.msTouchAction,e.style.msTouchAction="none")):e.addEventListener?(e.addEventListener("touchstart",g,!1),e.addEventListener("touchmove",g,!1),e.addEventListener("touchend",g,!1),e.addEventListener("touchcancel",g,!1),e.addEventListener("mousedown",g,!1),e.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(h=!0,e.addEventListener("mousemove",g,!1),e.addEventListener("mouseup",g,!1))):e.attachEvent&&e.setCapture&&(h=!0,e.attachEvent("onmousedown",function(){return g(window.event),window.event.returnValue=!1,!1}),e.attachEvent("onmousemove",function(){return g(window.event),window.event.returnValue=!1,!1}),e.attachEvent("onmouseup",function(){return g(window.event),window.event.returnValue=!1,!1}))},this.disable=function(){window.navigator.msPointerEnabled?(e.removeEventListener("MSPointerDown",g,!1),e.removeEventListener("MSPointerMove",g,!1),e.removeEventListener("MSPointerUp",g,!1),e.removeEventListener("MSPointerCancel",g,!1),s&&(e.style.msContentZooming=s),n&&(e.style.msTouchAction=n)):e.removeEventListener?(e.removeEventListener("touchstart",g,!1),e.removeEventListener("touchmove",g,!1),e.removeEventListener("touchend",g,!1),e.removeEventListener("touchcancel",g,!1),e.removeEventListener("mousedown",g,!1),e.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(h=!0,e.removeEventListener("mousemove",g,!1),e.removeEventListener("mouseup",g,!1))):e.detachEvent&&e.setCapture&&(h=!0,e.detachEvent("onmousedown"),e.detachEvent("onmousemove"),e.detachEvent("onmouseup"))},this}}]).factory("GridsterDraggable",["$document","$timeout","$window","GridsterTouch",function(t,i,r,s){function n(n,o,a,l,d){function g(t){if(-1!==H.indexOf(t.target.nodeName.toLowerCase()))return!1;if(e.element(t.target).hasClass("gridster-item-resizable-handler"))return!1;if(e.element(t.target).attr("onclick")||e.element(t.target).attr("ng-click"))return!1;switch(t.which){case 1:break;case 2:case 3:return}return Y=t.pageX,C=t.pageY,p=parseInt(n.css("left"),10),v=parseInt(n.css("top"),10),w=n[0].offsetWidth,z=n[0].offsetHeight,b=l.col,y=l.row,u(t),!0}function h(e){if(!n.hasClass("gridster-item-moving")||n.hasClass("gridster-item-resizing"))return!1;var t=a.curWidth-1;null!=a.maxRows&&($=a.rowsToPixels(a.maxRows)+(a.outerMargin?+a.margins[0]:a.margins[0])),x=e.pageX,I=e.pageY;var i=x-Y+M,r=I-C+X;M=X=0,Y=x,C=I;var s=i,o=r;return E>p+s?(i=E-p,M=s-i):p+w+s>t&&(i=t-p-w,M=s-i),S>v+o?(r=S-v,X=o-r):v+z+o>$&&(r=$-v-z,X=o-r),p+=i,v+=r,n.css({top:v+"px",left:p+"px"}),m(e),!0}function c(e){return!n.hasClass("gridster-item-moving")||n.hasClass("gridster-item-resizing")?!1:(M=X=0,f(e),!0)}function u(e){n.addClass("gridster-item-moving"),a.movingItem=l,a.updateHeight(l.sizeY),o.$apply(function(){a.draggable&&a.draggable.start&&a.draggable.start(e,n,d)})}function m(e){var t=l.row,i=l.col,s=a.draggable&&a.draggable.drag,g=a.draggable.scrollSensitivity,h=a.draggable.scrollSpeed,c=a.pixelsToRows(v),u=a.pixelsToColumns(p),m=a.getItems(c,u,l.sizeX,l.sizeY,l),f=0!==m.length;if(a.swapping===!0&&f){var w=a.getBoundingBox(m),z=w.sizeX===l.sizeX&&w.sizeY===l.sizeY,b=w.row===t,y=w.col===i,x=w.row===c&&w.col===u,I=b||y;if(z&&1===m.length){if(x)a.swapItems(l,m[0]);else if(I)return}else if(w.sizeX<=l.sizeX&&w.sizeY<=l.sizeY&&I)for(var Y=l.row<=c?l.row:c+l.sizeY,C=l.col<=u?l.col:u+l.sizeX,M=Y-w.row,X=C-w.col,S=0,$=m.length;$>S;++S){var E=m[S],H=a.getItems(E.row+M,E.col+X,E.sizeX,E.sizeY,l);0===H.length&&a.putItem(E,E.row+M,E.col+X)}}var L=!0;f&&(L=a.itemsInTheWayCanFit(m,c,u,l)),a.pushing===!1&&f||!L||(l.row=c,l.col=u),e.pageY-R.body.scrollTop<g?R.body.scrollTop=R.body.scrollTop-h:r.innerHeight-(e.pageY-R.body.scrollTop)<g&&(R.body.scrollTop=R.body.scrollTop+h),e.pageX-R.body.scrollLeft<g?R.body.scrollLeft=R.body.scrollLeft-h:r.innerWidth-(e.pageX-R.body.scrollLeft)<g&&(R.body.scrollLeft=R.body.scrollLeft+h),(s||t!==l.row||i!==l.col)&&o.$apply(function(){s&&a.draggable.drag(e,n,d)})}function f(e){n.removeClass("gridster-item-moving");var t=a.pixelsToRows(v),i=a.pixelsToColumns(p),r=a.getItems(t,i,l.sizeX,l.sizeY,l),s=0!==r.length,g=!0;s&&(g=a.itemsInTheWayCanFit(r,t,i,l)),a.pushing===!1&&s||!g||(l.row=t,l.col=i),a.movingItem=null,l.setPosition(l.row,l.col),o.$apply(function(){a.draggable&&a.draggable.stop&&a.draggable.stop(e,n,d)})}var p,v,w,z,b,y,x=0,I=0,Y=0,C=0,M=0,X=0,S=0,$=9999,E=0,R=t[0],H=["select","input","textarea","button"],L=!1,W=null,T=[];this.enable=function(){var t=this;i(function(){t.disable(),a.draggable&&a.draggable.handle?(W=e.element(n[0].querySelectorAll(a.draggable.handle)),0===W.length&&(W=n)):W=n;for(var i=0,r=W.length;r>i;++i)T[i]=new s(W[i],g,h,c),T[i].enable();L=!0})},this.disable=function(){if(L){for(var e=0,t=T.length;t>e;++e)T[e].disable();T=[],L=!1}},this.toggle=function(e){e?this.enable():this.disable()},this.destroy=function(){this.disable()}}return n}]).factory("GridsterResizable",["GridsterTouch",function(t){function i(i,r,s,n,o){function a(a){function l(e){switch(e.which){case 1:break;case 2:case 3:return}return b=s.draggable.enabled,b&&(s.draggable.enabled=!1,r.$broadcast("gridster-draggable-changed",s)),C=e.pageX,M=e.pageY,m=parseInt(i.css("left"),10),f=parseInt(i.css("top"),10),p=i[0].offsetWidth,v=i[0].offsetHeight,w=n.sizeX,z=n.sizeY,d(e),!0}function d(e){i.addClass("gridster-item-moving"),i.addClass("gridster-item-resizing"),s.movingItem=n,n.setElementSizeX(),n.setElementSizeY(),n.setElementPosition(),s.updateHeight(1),r.$apply(function(){s.resizable&&s.resizable.start&&s.resizable.start(e,i,o)})}function g(e){var t=s.curWidth-1;I=e.pageX,Y=e.pageY;var r=I-C+X,n=Y-M+S;X=S=0,C=I,M=Y;var o=n,a=r;return x.indexOf("n")>=0&&(v-o<H()?(n=v-H(),S=o-n):$>f+o&&(n=$-f,S=o-n),f+=n,v-=n),x.indexOf("s")>=0&&(v+o<H()?(n=H()-v,S=o-n):f+v+o>E&&(n=E-f-v,S=o-n),v+=n),x.indexOf("w")>=0&&(p-a<L()?(r=p-L(),X=a-r):R>m+a&&(r=R-m,X=a-r),m+=r,p-=r),x.indexOf("e")>=0&&(p+a<L()?(r=L()-p,X=a-r):m+p+a>t&&(r=t-m-p,X=a-r),p+=r),i.css({top:f+"px",left:m+"px",width:p+"px",height:v+"px"}),c(e),!0}function h(e){return s.draggable.enabled!==b&&(s.draggable.enabled=b,r.$broadcast("gridster-draggable-changed",s)),X=S=0,u(e),!0}function c(e){var t=n.row,l=n.col,d=n.sizeX,g=n.sizeY,h=s.resizable&&s.resizable.resize,c=n.col;-1!==["w","nw","sw"].indexOf(a)&&(c=s.pixelsToColumns(m,!1));var u=n.row;-1!==["n","ne","nw"].indexOf(a)&&(u=s.pixelsToRows(f,!1));var w=n.sizeX;-1===["n","s"].indexOf(a)&&(w=s.pixelsToColumns(p,!0));var z=n.sizeY;-1===["e","w"].indexOf(a)&&(z=s.pixelsToRows(v,!0)),(s.pushing!==!1||0===s.getItems(u,c,w,z,n).length)&&(n.row=u,n.col=c,n.sizeX=w,n.sizeY=z);var b=n.row!==t||n.col!==l||n.sizeX!==d||n.sizeY!==g;(h||b)&&r.$apply(function(){h&&s.resizable.resize(e,i,o)})}function u(e){i.removeClass("gridster-item-moving"),i.removeClass("gridster-item-resizing"),s.movingItem=null,n.setPosition(n.row,n.col),n.setSizeY(n.sizeY),n.setSizeX(n.sizeX),r.$apply(function(){s.resizable&&s.resizable.stop&&s.resizable.stop(e,i,o)})}var m,f,p,v,w,z,b,y,x=a,I=0,Y=0,C=0,M=0,X=0,S=0,$=0,E=9999,R=0,H=function(){return s.curRowHeight-s.margins[0]},L=function(){return s.curColWidth-s.margins[1]},W=null;this.enable=function(){W||(W=e.element('<div class="gridster-item-resizable-handler handle-'+x+'"></div>'),i.append(W)),y=new t(W[0],l,g,h),y.enable()},this.disable=function(){W&&(W.remove(),W=null),y.disable(),y=void 0},this.destroy=function(){this.disable()}}var l=[],d=s.resizable.handles;"string"==typeof d&&(d=s.resizable.handles.split(","));for(var g=!1,h=0,c=d.length;c>h;h++)l.push(new a(d[h]));this.enable=function(){if(!g){for(var e=0,t=l.length;t>e;e++)l[e].enable();g=!0}},this.disable=function(){if(g){for(var e=0,t=l.length;t>e;e++)l[e].disable();g=!1}},this.toggle=function(e){e?this.enable():this.disable()},this.destroy=function(){for(var e=0,t=l.length;t>e;e++)l[e].destroy()}}return i}]).factory("gridsterDebounce",function(){return function(e,t,i){var r;return function(){var s=this,n=arguments,o=function(){r=null,i||e.apply(s,n)},a=i&&!r;clearTimeout(r),r=setTimeout(o,t),a&&e.apply(s,n)}}}).directive("gridsterItem",["$parse","GridsterDraggable","GridsterResizable","gridsterDebounce","$rootScope",function(e,t,i,r,s){return{scope:!0,restrict:"EA",controller:"GridsterItemCtrl",controllerAs:"gridsterItem",require:["^gridster","gridsterItem"],link:function(n,o,a,l){function d(){f.setPosition(f.row,f.col),w.row&&w.row.assign&&w.row.assign(n,f.row),w.col&&w.col.assign&&w.col.assign(n,f.col)}function g(){var e=f.setSizeX(f.sizeX,!0);e&&w.sizeX&&w.sizeX.assign&&w.sizeX.assign(n,f.sizeX);var t=f.setSizeY(f.sizeY,!0);t&&w.sizeY&&w.sizeY.assign&&w.sizeY.assign(n,f.sizeY),(e||t)&&(f.gridster.moveOverlappingItems(f),m.layoutChanged(),n.$broadcast("gridster-item-resized",f))}function h(){var e=document.createElement("div"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in t)if(void 0!==e.style[i])return t[i]}var c,u=a.gridsterItem,m=l[0],f=l[1];if(n.gridster=m,u){var p=e(u);if(c=p(n)||{},!c&&p.assign)c={row:f.row,col:f.col,sizeX:f.sizeX,sizeY:f.sizeY,minSizeX:0,minSizeY:0,maxSizeX:null,maxSizeY:null},p.assign(n,c);else if(f.id=c.id,c.sizeY>n.gridster.maxRows||c.sizeX>n.gridster.columns)return void s.$broadcast("gridster-item-unplaceable",f)}else c=a;f.init(o,m),o.addClass("gridster-item");for(var v=["minSizeX","maxSizeX","minSizeY","maxSizeY","sizeX","sizeY","row","col"],w={},z=[],b=function(t){var i;if("string"==typeof c[t])i=c[t];else if("string"==typeof c[t.toLowerCase()])i=c[t.toLowerCase()];else{if(!u)return;i=u+"."+t}z.push('"'+t+'":'+i),w[t]=e(i);var r=w[t](n);"number"==typeof r&&(f[t]=r)},y=0,x=v.length;x>y;++y)b(v[y]);var I="{"+z.join(",")+"}";n.$watchCollection(I,function(e,t){for(var i in e){var r=e[i],s=t[i];s!==r&&(r=parseInt(r,10),isNaN(r)||(f[i]=r))}}),n.$watch(function(){return f.row+","+f.col},d),n.$watch(function(){return f.sizeY+","+f.sizeX+","+f.minSizeX+","+f.maxSizeX+","+f.minSizeY+","+f.maxSizeY},g);var Y=new t(o,n,m,f,c),C=new i(o,n,m,f,c);C.toggle(!m.isMobile&&m.resizable&&m.resizable.enabled),Y.toggle(!m.isMobile&&m.draggable&&m.draggable.enabled),n.$on("gridster-draggable-changed",function(){Y.toggle(!m.isMobile&&m.draggable&&m.draggable.enabled)}),n.$on("gridster-resizable-changed",function(){C.toggle(!m.isMobile&&m.resizable&&m.resizable.enabled)}),n.$on("gridster-resized",function(){C.toggle(!m.isMobile&&m.resizable&&m.resizable.enabled)}),n.$on("gridster-mobile-changed",function(){C.toggle(!m.isMobile&&m.resizable&&m.resizable.enabled),Y.toggle(!m.isMobile&&m.draggable&&m.draggable.enabled)});var M=r(function(){n.$apply(function(){n.$broadcast("gridster-item-transition-end",f)})},50);return o.on(h(),M),n.$broadcast("gridster-item-initialized",f),n.$on("$destroy",function(){try{C.destroy(),Y.destroy()}catch(e){}try{m.removeItem(f)}catch(e){}try{f.destroy()}catch(e){}})}}}])}(angular);